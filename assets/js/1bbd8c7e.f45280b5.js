"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[1770],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||s;return n?a.createElement(g,o(o({ref:t},p),{},{components:n})):a.createElement(g,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var c=2;c<s;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9580:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var a=n(7462),r=n(3366),s=(n(7294),n(3905)),o=["components"],i={sidebar_label:"Message Format",sidebar_position:3},l="Message communication format",c={unversionedId:"developing-contracts/messaging",id:"developing-contracts/messaging",title:"Message communication format",description:"Interaction with each program takes place by messaging.",source:"@site/docs/developing-contracts/messaging.md",sourceDirName:"developing-contracts",slug:"/developing-contracts/messaging",permalink:"/developing-contracts/messaging",editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/developing-contracts/messaging.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_label:"Message Format",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Program State",permalink:"/developing-contracts/gear-program"},next:{title:"Program testing",permalink:"/developing-contracts/testing"}},p=[{value:"Types of messages",id:"types-of-messages",children:[],level:2},{value:"Gas",id:"gas",children:[],level:2},{value:"Message process module",id:"message-process-module",children:[],level:2},{value:"Understandble messages. Encode/Decode",id:"understandble-messages-encodedecode",children:[],level:2}],u={toc:p};function d(e){var t=e.components,n=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"message-communication-format"},"Message communication format"),(0,s.kt)("p",null,"Interaction with each program takes place by messaging."),(0,s.kt)("p",null,"Messages in Gear have common interface with the following parameters:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"source account,\ntarget account,\npayload,\ngas_limit\nvalue\n")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"gas_limit")," is the amount of gas that users are willing to spend to process the message."),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"value")," is a value to be transferred to the target account. In the special message of the initial program upload, the value will be transferred to a balance of the newly created account for the program."),(0,s.kt)("h2",{id:"types-of-messages"},"Types of messages"),(0,s.kt)("p",null,"In the case of the program, there are the following types of messages:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"From user to program"),(0,s.kt)("li",{parentName:"ul"},"From program to program"),(0,s.kt)("li",{parentName:"ul"},"From program to the user"),(0,s.kt)("li",{parentName:"ul"},"A special message from the user to upload a new program to the network. The payload must contain the Wasm file of the program itself. Target account must not be specified - it will be created as a part of processing message post.")),(0,s.kt)("h2",{id:"gas"},"Gas"),(0,s.kt)("p",null,"Gear node charges a gas fee during message processing. The gas fee is linear - 64000 gas per allocated memory page of size 64KB and 1000 gas per instrumented Wasm instruction. Messages from transactions with the highest fee are taken first. In this case, messages from transactions with the lowest fee can be delayed or even never end up in the processing queue. If a transaction is processed before the limit is reached, the rest of the gas will be returned to the sending account."),(0,s.kt)("h2",{id:"message-process-module"},"Message process module"),(0,s.kt)("p",null,"Depending on the context the program interprets messages differently. To process messages in Gear programs, the proprietary ",(0,s.kt)("inlineCode",{parentName:"p"},"gstd")," standart library and the ",(0,s.kt)("inlineCode",{parentName:"p"},"::msg")," module is used. All available functions described in msg.rs in gstd:"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/gear-tech/gear/blob/master/gstd/src/msg.rs"},"github link")),(0,s.kt)("p",null,"Load bytes and try to decode to the specified type with ",(0,s.kt)("inlineCode",{parentName:"p"},"SCALE codec"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn load<D: Decode>() -> Result<D, codec::Error> {\n    D::decode(&mut load_bytes().as_ref())\n}\n")),(0,s.kt)("p",null,"Load bytes:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn load_bytes() -> Vec<u8> {\n    let mut result = vec![0u8; gcore::msg::size()];\n    gcore::msg::load(&mut result[..]);\n    result\n}\n")),(0,s.kt)("p",null,"Reply to a message and try to enecode to the specified type with ",(0,s.kt)("inlineCode",{parentName:"p"},"SCALE codec"),". Returns ",(0,s.kt)("inlineCode",{parentName:"p"},"MessageId"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn reply<E: Encode>(payload: E, gas_limit: u64, value: u128) -> MessageId {\n    reply_bytes(&payload.encode(), gas_limit, value)\n}\n")),(0,s.kt)("p",null,"Reply to a message with bytes in ",(0,s.kt)("inlineCode",{parentName:"p"},"payload"),". Returns ",(0,s.kt)("inlineCode",{parentName:"p"},"MessageId"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn reply_bytes<T: AsRef<[u8]>>(payload: T, gas_limit: u64, value: u128) -> MessageId {\n    gcore::msg::reply(payload.as_ref(), gas_limit, value)\n}\n")),(0,s.kt)("h2",{id:"understandble-messages-encodedecode"},"Understandble messages. Encode/Decode"),(0,s.kt)("p",null,"Gear uses the ",(0,s.kt)("inlineCode",{parentName:"p"},"parity-scale-codec"),", a Rust implementation of the SCALE Codec. SCALE is a lightweight format that allows encoding (and decoding) which makes it highly suitable for resource-constrained execution environments like blockchain runtimes and low-power, low-memory devices."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"#[derive(Encode, Decode)]\n")),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/advanced/codec"},"Learn more about SCALE Codec")))}d.isMDXComponent=!0}}]);