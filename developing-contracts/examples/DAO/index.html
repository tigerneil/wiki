<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Decentralized autonomous organization | Gear documentation portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wiki.gear-tech.io//developing-contracts/examples/DAO"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Decentralized autonomous organization | Gear documentation portal"><meta data-react-helmet="true" name="description" content="The smart-contract is available on GitHub//github.com/gear-tech/apps/tree/master/dao"><meta data-react-helmet="true" property="og:description" content="The smart-contract is available on GitHub//github.com/gear-tech/apps/tree/master/dao"><link data-react-helmet="true" rel="icon" href="/img/favicon-32x32.png"><link data-react-helmet="true" rel="canonical" href="https://wiki.gear-tech.io//developing-contracts/examples/DAO"><link data-react-helmet="true" rel="alternate" href="https://wiki.gear-tech.io//developing-contracts/examples/DAO" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.gear-tech.io//zh-cn/developing-contracts/examples/DAO" hreflang="zh-cn"><link data-react-helmet="true" rel="alternate" href="https://wiki.gear-tech.io//developing-contracts/examples/DAO" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.fb4df1ba.css">
<link rel="preload" href="/assets/js/runtime~main.104e92f9.js" as="script">
<link rel="preload" href="/assets/js/main.01f51f45.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-black.svg" alt="Gear documentation portal" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo-white.svg" alt="Gear documentation portal" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Gear Wiki</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gear-tech/wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/developing-contracts/examples/DAO" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/zh-cn/developing-contracts/examples/DAO" target="_self" rel="noopener noreferrer" class="dropdown__link">ç®€ä½“ä¸­æ–‡</a></li></ul></div><div class="toggle_Pssr toggle_TdHA toggleChecked_cnQY toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" checked="" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome!</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/gear/glossary">Intro to Gear</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/ecosystem/polkadot">Ecosystem</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/getting-started-in-5-minutes">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/idea/idea-overview">Gear IDEA</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/node/setting-up">Gear Node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/developing-contracts/cargo-program">Developing Smart Contracts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/cargo-program">Cargo-program Utility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/gear-program">Program State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/messaging">Message Format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/testing">Program testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/deploy">Upload Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/send-a-transaction">Send a Message</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/developing-contracts/examples/prerequisites">Examples</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/examples/prerequisites">Prerequisites</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/examples/ping">PING-PONG</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/examples/erc-721">ERC-721: NFT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/examples/erc20">ERC-20</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/developing-contracts/examples/DAO">DAO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developing-contracts/examples/feeds">Gear Feeds</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/api/connect">API for interacting with node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/general/web3">General topics</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Decentralized autonomous organization</h1><p>The smart-contract is available on GitHub: <a href="https://github.com/gear-tech/apps/tree/master/dao" target="_blank" rel="noopener noreferrer">https://github.com/gear-tech/apps/tree/master/dao</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="source-files">Source files<a class="hash-link" href="#source-files" title="Direct link to heading">â€‹</a></h2><ol><li><code>erc20_functions.rs</code> - contains functions of the ERC20 contract. DAO contract interacts ERC20 contract through functions <code>transfer_tokens</code> and <code>balance</code>:</li></ol><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub async fn transfer_tokens(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        token_id: &amp;ActorId, /// - the ERC-20 contracts address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from: &amp;ActorId, /// - the sender address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        to: &amp;ActorId, /// - the recipient address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        amount: u128, /// - the amount of tokens</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This function sends a message (the action is defined in the enum <code>TokenAction</code>) and gets a reply (the reply is defined in the enum <code>TokenEvent</code>):</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let transfer_response: TokenEvent = msg::send_and_wait_for_reply(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        *token_id, /// - the ERC-20 contracts address,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        TokenAction::Transfer(transfer_data), /// - action in ERC20-contract</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        exec::gas_available() - GAS_RESERVE,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The function balance is defined in a similar way:</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub async fn balance(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        token_id: &amp;ActorId, /// - the ERC-20 contracts address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        account: &amp;ActorId, /// - the account address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and sends a message:</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">let balance_response: TokenEvent = msg::send_and_wait_for_reply(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        *token_id, /// - the ERC-20 contracts address,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        TokenAction::BalanceOf(H256::from_slice(account.as_ref())) /// - action in ERC20-contract</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        exec::gas_available() - GAS_RESERVE,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="2"><li><p><code>payloads.rs</code> - contains structs that the contract receives and sends in the reply.</p></li><li><p><code>lib.rs</code> - defines the contract logic.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="structs">Structs<a class="hash-link" href="#structs" title="Direct link to heading">â€‹</a></h2><p>The contract has the following structs:</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">struct Dao {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    admin: ActorId,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    approved_token_program_id: ActorId,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    period_duration: u64,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    voting_period_length: u64,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    grace_period_length: u64,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dilution_bound: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    abort_window: u64, </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    total_shares: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    members: BTreeMap&lt;ActorId, Member&gt;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    member_by_delegate_key: BTreeMap&lt;ActorId, ActorId&gt;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    proposal_id: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    proposals: BTreeMap&lt;u128, Proposal&gt;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    approved_list: Vec&lt;ActorId&gt;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where:</p><p><code>admin</code> - the only member that is initially in DAO. He has 1 share that allows him to submit new proposal and therefore add new members.</p><p><code>approved_token_program_id</code> - the reference to the token contract (ERC20) that users use as pledge to get the share in the DAO.</p><p><code>period_duration</code> - the smallest unit time interval for the DAO, in ms.</p><p><code>voting_period_length</code> - voting time interval. Number of intervals for voting time = period duration * voting_period_length.</p><p><code>grace_period_length</code> - after the voting period the DAO members are given a period of time in which they can leave the DAO(ragequit) without being diluted and ultimately affected by the proposalâ€™s acceptance into the DAO.</p><p><code>dilution_bound</code> - the dilution bound protects members from excessive dilution in case of a mass ragequit. It is designed to mitigate an issue where a proposal is passed, then many users rage quit from the DAO. The proposal will be automatically rejected if the total amount of shares becomes dilutionBound times less than it was before.</p><p><code>abort_window</code> - the time interval during which the applicant can cancel the proposal with funds refunded (that starts immediately when the proposal is submitted).</p><p><code>total_shares</code> - total shares across all members. Initially it is zero.</p><p><code>members</code> - members of the DAO.</p><p><code>member_by_delegate_key</code> - mapping the key responsible for submitting proposals and the member address.</p><p><code>proposal_id</code> - the index of the last proposal.</p><p><code>proposals</code> - all proposals (the proposal queue).</p><p><code>approved_list</code> - list of actors that are approved for joining the DAO.</p><p>Parameters <code>admin</code>, <code>approved_token_program_id</code>, <code>period_duration</code>, <code>grace_period_length</code>, <code>dilution_bound</code>, <code>abort_window</code> are set when initializing a contract. The contract is initialized in the function:</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#[no_mangle]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub unsafe extern &quot;C&quot; fn init() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>with the following struct: </p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">struct InitConfig {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    admin: H256,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    approved_token_program_id: H256,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    guild_bank_id: H256,    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    period_duration: u64,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    voting_period_length: u64,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    grace_period_length: u64,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dilution_bound: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    abort_window: u64,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The proposal struct:</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> pub struct Proposal {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub proposer: ActorId, /// - the member who submitted the proposal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub applicant: ActorId, /// - the applicant who wishes to become a member </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub shares_requested: u128, /// - the amount of shares the applicant is requesting</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub yes_votes: u128, /// - the total number of YES votes for that proposal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub no_votes: u128, /// - the total number of NO votes for that proposal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub quorum: u128, /// - a certain threshold of YES votes in order for the proposal to pass</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub is_membership_proposal: bool, /// - true if it is a membership proposal, false if it is a funding proposal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub processed: bool, /// - true if the proposal has already been processed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub did_pass: bool, /// - true if the proposal has passed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub canceled: bool, /// - true if the proposal has been canceled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub aborted: bool, /// - true if the proposal has been aborted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub token_tribute: u128, /// - the number of tokens offered for shares</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub details: String, /// - proposal details</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub starting_period: u64, /// - the start of the voting period</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub max_total_shares_at_yes_vote: u128, /// - the number of total shares that were detected at yes votes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub votes_by_member: BTreeMap&lt;H256, Vote&gt;, /// - the votes on that proposal by each member</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The member struct:</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub struct Member {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub delegate_key: ActorId, /// - the key responsible for submitting proposals and voting ( by default it is equal to member address)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub shares: u128, /// - the shares of that member</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub highest_index_yes_vote: u128, /// - the index of the highest proposal on which the members voted YES (that value is checked when user is going to leave the DAO)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The actions that the contract receives outside are defined in enum <code>Actions</code>. The contract&#x27;s replies are defined in the enum <code>Events</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="dao-functions">DAO functions<a class="hash-link" href="#dao-functions" title="Direct link to heading">â€‹</a></h2><ul><li>Adds actors to approved list. The added actors can deposit their tokens to DAO and a DAO member can submit a proposal of joining them to DAO members.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn add_to_approved_list(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        member: &amp;ActorId,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>The proposal of joining the DAO. The proposal can be submitted only by the existing members.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">async fn submit_membership_proposal(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        applicant: &amp;ActorId,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        token_tribute: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        shares_requested: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        quorum: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        details: String,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>The funding proposal. The &#x27;applicant&#x27; is an actor that will be funded.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">async fn submit_funding_proposal(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â applicant: &amp;ActorId,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â amount: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â quorum: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â details: String,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>The member or the delegate address of the member submit his vote (YES or NO) on the proposal.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">async fn submit_vote(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â proposal_id: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â vote: Vote,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>The right of the applicant to abort the proposal. It can be used in case of the applicant disagreed with the requested shares or the details the proposer indicated by the proposer.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">async fn abort(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â proposal_id: u128</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>The right of the proposer to cancel the proposal after the end of the voting period if there are no YES votes.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">async fn cancel_proposal(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â proposal_id: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>The right for members to withdraw their capital during the grace period. It can be used when the members donâ€™t agree with the result of the proposal and the acceptance of that proposal can affect their shares. The member can ragequit only if he has voted NO on that proposal.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">async fn ragequit(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â amount: u128,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>The proposal processing after the proposal competes during the grace period. If the proposal is accepted, the tribute tokens are deposited into the contract and new shares are minted and issued to the applicant. If the proposal is rejected, the tribute tokens are returned to the applicant.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">async fn process_proposal(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â &amp;mut self,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â Â Â Â Â proposal_id: u128</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Â Â Â Â )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>These functions are called in <code>async fn main()</code> through enum <code>Actions</code>.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    #[gstd::async_main] </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    async fn main() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let action: Action = msg::load().expect(&quot;Could not load Action&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        match action {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Action::AddToWhiteList(input) =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DAO.add_to_whitelist(&amp;ActorId::new(input.to_fixed_bytes()))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Action::SubmitMembershipProposal(input) =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            let applicant = ActorId::new(input.applicant.to_fixed_bytes());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DAO.submit_membership_proposal(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &amp;applicant,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                input.token_tribute,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                input.shares_requested,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                input.quorum,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                input.details,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            .await;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Action::SubmitFundingProposal(input) =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            let applicant = ActorId::new(input.applicant.to_fixed_bytes());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DAO.submit_funding_proposal(&amp;applicant, input.amount, input.quorum, input.details)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .await;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>It is also important to have the ability to read the contract state off-chain. It is defined in the <code>fn meta_state()</code>.  The contract receives a request to read the certain data (the possible requests are defined in struct <code>State</code>) and sends replies. The contracts replies about its state are defined in the enum <code>StateReply</code>.</li></ul><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub unsafe extern &quot;C&quot; fn meta_state() -&gt; *mut [i32; 2] {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let state: State = msg::load().expect(&quot;failed to decode input argument&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let encoded = match state {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        State::IsMember(input) =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    StateReply::IsMember(DAO.is_member(&amp;ActorId::new(input.to_fixed_bytes()))).encode()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let result = gstd::macros::util::to_wasm_ptr(&amp;(encoded[..]));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    core::mem::forget(encoded);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    result</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/gear-tech/wiki/edit/master/docs/developing-contracts/examples/DAO.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/developing-contracts/examples/erc20"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ERC-20</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/developing-contracts/examples/feeds"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Gear Feeds</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#source-files" class="table-of-contents__link toc-highlight">Source files</a></li><li><a href="#structs" class="table-of-contents__link toc-highlight">Structs</a></li><li><a href="#dao-functions" class="table-of-contents__link toc-highlight">DAO functions</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.104e92f9.js"></script>
<script src="/assets/js/main.01f51f45.js"></script>
</body>
</html>