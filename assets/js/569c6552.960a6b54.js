"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[936],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return u}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),s=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=s(n),u=a,f=m["".concat(p,".").concat(u)]||m[u]||d[u]||o;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5588:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return c},default:function(){return m}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],l={sidebar_label:"ERC-721: NFT",sidebar_position:3},p="ERC-721: NFT",s={unversionedId:"developing-contracts/examples/erc-721",id:"developing-contracts/examples/erc-721",title:"ERC-721: NFT",description:"Introduction",source:"@site/docs/developing-contracts/examples/erc-721.md",sourceDirName:"developing-contracts/examples",slug:"/developing-contracts/examples/erc-721",permalink:"/developing-contracts/examples/erc-721",editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/developing-contracts/examples/erc-721.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_label:"ERC-721: NFT",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"PING-PONG",permalink:"/developing-contracts/examples/ping"},next:{title:"ERC-20",permalink:"/developing-contracts/examples/erc20"}},c=[{value:"Introduction",id:"introduction",children:[],level:2},{value:"ERC-721 interface",id:"erc-721-interface",children:[],level:2},{value:"NFT example",id:"nft-example",children:[],level:2},{value:"Conclusion",id:"conclusion",children:[],level:2}],d={toc:c};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"erc-721-nft"},"ERC-721: NFT"),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"At Gear, we want to provide an ecosystem for developers coming from various backgrounds. We have to note that Gear offers far more advanced features and technological developments compared to platforms that popular protocols like ERC-20 or ERC-721 were designed for. However, it would be inefficient to ignore such widely used interfaces in favor of arbitrary, but modern implementations. Therefore, Gear provides support for ERC-721 based NFT tokens, as well as an updated standard based on Gear's vision."),(0,o.kt)("p",null,"In this article, we will cover usage of Gear's ERC-721 interface library in composition with an example NFT implementation."),(0,o.kt)("h2",{id:"erc-721-interface"},"ERC-721 interface"),(0,o.kt)("p",null,"ERC-721 protocol is a community-accepted standard for Non-Fungible Tokens (NFTs) smart contract implementation. In this article, we will go over the details of how to use the ERC-721 interface provided by Gear via an example."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-721"},"ERC-721")," describes the interface that has to be implemented by a smart contract in order to be compliant. The following functions are expected to be present in the NFT contract:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},'/// This emits when ownership of any NFT changes by any mechanism.\nTransfer(from, to, tokenId);\n\n/// This emits when the approved address for an NFT is changed or reaffirmed.\nApprovalForAll(_owner, operator, approved);\n\n/// Count all NFTs assigned to an owner\nbalanceOf(owner): integer;\n\n/// Find the owner of an NFT\nownerOf(tokenId): address;\n\n/// Transfers the ownership of an NFT from one address to another address\nsafeTransferFrom(from, to, tokenId, data: optional);\n\n/// Transfer ownership of an NFT\ntransferFrom(from, to, tokenId);\n\n/// Change or reaffirm the approved address for an NFT\napprove(approved, tokenId);\n\n/// Enable or disable approval for a third party ("operator") to manage\nsetApprovalForAll(operator, approved);\n\n/// Get the approved address for a single NFT\ngetApproved(tokenId): address;\n\n/// @notice Query if an address is an authorized operator for another address\nisApprovedForAll(owner, operator): bool;\n')),(0,o.kt)("p",null,"However, implicitly, some functions - like ",(0,o.kt)("inlineCode",{parentName:"p"},"mint")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"burn")," - are expected to be implemented in the contract as well. Implementation for those functions may vary, therefore leading to existence various NFT collections."),(0,o.kt)("p",null,"Gear provides an ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gear-tech/apps/tree/master/non-fungible-token"},"ERC-721 interface library")," with shared functionality described in the protocol."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Please note that the interface does ",(0,o.kt)("strong",{parentName:"p"},"not")," yet support features like ",(0,o.kt)("inlineCode",{parentName:"p"},"ERC721TokenReceiver")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"SafeTransferFrom"),". However, those will be added as soon as possible."))),(0,o.kt)("p",null,"The NonFungibleToken interface introduces the ",(0,o.kt)("inlineCode",{parentName:"p"},"NonFungibleTokenBase")," trait that contains the following function signatures:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"/// called during the NFT contract deployment\nfn init(&mut self, name: String, symbol: String, base_uri: String);\n\n/// Transfer an NFT item from current owner to the new one\nfn transfer(&mut self, rom: &ActorId, to: &ActorId, token_id: U256);\n\n/// Gives a right to the actor to manage the specific token\nfn approve(&mut self, owner: &ActorId, spender: &ActorId, token_id: U256);\n\n/// Enables or disables the actor to manage all the tokens the owner has\nfn approve_for_all(&mut self, owner: &ActorId, operator: &ActorId, approved: bool);\n")),(0,o.kt)("p",null,"Functions above are essential for an NFT implementation and are implemented in the interface provided by Gear."),(0,o.kt)("p",null,"The core component of the ERC-721 interface library is the ",(0,o.kt)("inlineCode",{parentName:"p"},"NonFungibleToken")," struct. It contains implementations for the functions defined in the ",(0,o.kt)("inlineCode",{parentName:"p"},"NonFungibleTokenBase")," trait and some useful helper functions such as ",(0,o.kt)("inlineCode",{parentName:"p"},"authorized_actor"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"is_token_owner"),", etc."),(0,o.kt)("p",null,"Gear's ERC-721 interface is a library that can be used as a core block in writing a smart contract for an NFT implementation. Let's take a look at how this interface can be composed into a complete contract."),(0,o.kt)("h2",{id:"nft-example"},"NFT example"),(0,o.kt)("p",null,"In this section, we will be referring to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gear-tech/apps/tree/master/nft-example"},"this")," implementation example of an NFT smart contract provided by Gear."),(0,o.kt)("p",null,"First of all, the actions accepted by the contract should be in accordance with ERC-721:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"pub enum Action {\n    Mint,\n    Burn(U256),\n    Transfer(TransferInput),\n    Approve(ApproveInput),\n    ApproveForAll(ApproveForAllInput),\n    OwnerOf(U256),\n    BalanceOf(H256),\n}\n")),(0,o.kt)("p",null,"The state querying methods complete the interface compliance:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"pub enum State {\n    BalanceOfUser(H256),\n    TokenOwner(U256),\n    IsTokenOwner(TokenAndUser),\n    GetApproved(U256),\n}\n")),(0,o.kt)("p",null,"Gear's ERC-721 library contains full implementations for ",(0,o.kt)("inlineCode",{parentName:"p"},"transfer"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"approve")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"approve_for_all")," actions. Let's take advantage of those by importing the library and storing it in the state of the contract."),(0,o.kt)("p",null,"Keep in mind, that the library also contains multiple useful structs such as ",(0,o.kt)("inlineCode",{parentName:"p"},"Approve"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"ApproveForAll")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Transfer")," that can be reused for a custom implementation."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct NFT {\n    pub tokens: NonFungibleToken,\n    pub token_id: U256,\n    pub owner: ActorId,\n}\n")),(0,o.kt)("p",null,"Note how ",(0,o.kt)("inlineCode",{parentName:"p"},"NonFungibleToken")," struct from the ERC-721 library is composed inside the state; that allows to reuse the functionality it provides within the implementation of the contract's methods."),(0,o.kt)("p",null,"We will also need custom implementation for the ",(0,o.kt)("inlineCode",{parentName:"p"},"mint")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"burn")," methods as mentioned above."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"impl NFT {\n    fn mint(&mut self) {\n      // custom mint implementation\n      ...\n    }\n\n    fn burn(&mut self, token_id: U256) {\n      // custom burn implementation\n      ...\n    }\n}\n")),(0,o.kt)("p",null,"Now, inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"handle")," method, we can use ",(0,o.kt)("inlineCode",{parentName:"p"},"mint")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"burn")," described above for ",(0,o.kt)("inlineCode",{parentName:"p"},"Mint")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Burn")," actions. For the rest of the actions (i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"Approve"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"ApproveForAll"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Transfer"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"OwnerOf")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"BalanceOf"),"), we can reuse Gear's ERC-721 library implementations."),(0,o.kt)("p",null,"Same goes for state querying, i.e. the ",(0,o.kt)("inlineCode",{parentName:"p"},"metastate")," method: library functions can be reused for query implementations."),(0,o.kt)("p",null,"For example, the ",(0,o.kt)("inlineCode",{parentName:"p"},"Mint")," action can be implemented simply as:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"Action::Mint => {\n    CONTRACT.mint();\n}\n")),(0,o.kt)("p",null,"Similarly, take a look at ",(0,o.kt)("inlineCode",{parentName:"p"},"Approve")," that takes advantage of the provided interface:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"Action::Approve(input) => {\n    CONTRACT.tokens.approve(\n        &msg::source(),\n        &ActorId::new(input.to.to_fixed_bytes()),\n        input.token_id,\n    );\n}\n")),(0,o.kt)("h2",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"Gear provides a reusable ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gear-tech/apps/tree/master/non-fungible-token/src"},"library")," with core functionality for the ERC-721 protocol. By using object composition, that library can be utilized within a custom NFT contract implementation in order to minimize duplication of community available code."),(0,o.kt)("p",null,"A source code of the contract example provided by Gear is available on GitHub: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gear-tech/apps/tree/master/nft-example/src"},"nft-example/src"),"."),(0,o.kt)("p",null,"See also an example of the smart contract testing implementation based on ",(0,o.kt)("inlineCode",{parentName:"p"},"gtest"),": ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gear-tech/apps/tree/master/nft-example/tests"},"nft-example/tests"),"."),(0,o.kt)("p",null,"For more details about testing smart contracts written on Gear, refer to this article: ",(0,o.kt)("a",{parentName:"p",href:"/developing-contracts/testing"},"Program testing"),"."))}m.isMDXComponent=!0}}]);